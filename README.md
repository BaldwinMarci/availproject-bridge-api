# Bridge API

The bridge API is a REST API for fetching proofs from Avail's Kate RPC and Succinct API to submit on Ethereum or
any off-chain proof verification.

## Deploying the bridge API

* Create an `.env` file according to the `.env.example`
* To build the service:

```bash
# for developing, make a debug build
cargo build
# and run it!
cargo run
```

* Or instead, make release builds for production:

```bash
cargo run --release
# you can use maxperf to optimize for runtime performance:
cargo run --profile maxperf
# you can use RUSTFLAGS to use CPU-native optimizations:
RUSTFLAGS="-C target-cpu=native" cargo run --profile maxperf
```

## Usage

* The bridge API operates on the 8080 port by default (can be configured).

### Liveness of the server

* To verify that the API is live, you can query the root like:

    * Request

      `GET /`

      ```bash
      # curl <endpoint URL>
      curl http://localhost:8080
      ```

    * Response

      ```json
      {"name":"Avail Bridge API"}
      ```

### Get current Ethereum head

* To get the latest Ethereum block number, query:
    * Request
      `GET /eth/head`

      ```bash
      # curl <endpoint URL>/eth/head
      curl http://localhost:8080/eth/head
      ```
        * Response

      ```json
      {"slot":4454752,"timestamp":1709191840,"timestampDiff":1716}
      ```

### Get current Avail head

* To get the latest Avail block number, query:
    * Request
      `GET /avl/head`

      ```bash
      # curl <endpoint URL>/avl/head
      curl http://localhost:8080/avl/head
      ```
        * Response

      ```json
      {"data":{"end":512738,"start":488581}}
      ```

### Generate Merkle Proof

* To generate a proof, simply query the `eth/proof` endpoint with the block hash and extrinsic index like (both are
  required):

    * Request

      `GET /eth/proof/:blockhash?index=`

      ```bash
      # curl "<endpoint URL>/eth/proof/<blockhash>?index=<tx_index>"
      curl "http://localhost:8080/eth/proof/0x9f9cc9b3af8a753f769dfa6c9fe4ab13c089a37e602f4e0496aa25534c1baba1?index=1"
      ```

    * Response

      ```json
      {
      "blobRoot":"0x0000000000000000000000000000000000000000000000000000000000000000",
      "blockHash":"0x9f9cc9b3af8a753f769dfa6c9fe4ab13c089a37e602f4e0496aa25534c1baba1",
      "bridgeRoot":"0x7130a7ba8991180769a183c1239d8914ab8700af39273d52d88f0c06dbbdd310",
      "dataRoot":"0x214f632dde190c7fa8a8fe8225c7a1f9f1dfa21e0b2cd7dadeef3f95ebec8c6a",
      "dataRootCommitment":"0x6a8da698b22f1fb55a16b5899be7d192caa81f7489221243c11e267ed0e1377b",
      "dataRootIndex":71,
      "dataRootProof":[
      "0xad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb5",
      "0x51f84e7279cdf6acb81af77aec64f618f71029b7d9c6d37c035c37134e517af2",
      "0x69c8458dd62d27ea9abd40586ce53e5220d43b626c27f76468a57e94347f0d6b",
      "0x5a021e65ea5c6b76469b68db28c7a390836e22c21c6f95cdef4d3408eb6b8050",
      "0xfd4cd11dc8da59a673fcf1a061350f63ef7214a328fe48927486c9df8804ecc0",
      "0x83aeb54660d9c6158085a50947e76e4ac01c95fd9b30e6d3bc865810ba6e73c4",
      "0xe51e1602448430542788cabb952ab87348561d146fe366b2525e581c0530c77e",
      "0xa8fe638d4e60df885487b457c6c6141f02b42bc84cf67a656e71b41a1ce7edb9"
      ],
      "leaf":"0x7130a7ba8991180769a183c1239d8914ab8700af39273d52d88f0c06dbbdd310",
      "leafIndex":0,
      "leafProof":[
    
      ],
      "message":{
        "data":[49, 50, 49, 50],
        "destinationDomain":2,
        "from":"0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d",
        "id":93,
        "messageType":"arbitraryMessage",
        "originDomain":1,
        "to":"0x0000000000000000000000000000000000000000000000000000000000000000"
      },
      "rangeHash":"0x2ad99bcda44fea1f7ee7c7006f03365ae0bdc9686d9eda549e99a9953b371d80"
      }
      ```

### Get Account/Storage proofs

* To get a proof, simply query the `/avl/proof/:message_id` endpoint with the message id:

  * Request

    `GET /avl/proof/:block_hash/:messageId`

      ```bash
      # curl "<endpoint URL>/avl/proof/<blockhash>/<messageId>"
      curl "http://localhost:8080/avl/proof/0x7963d8403d137cb5560e2436df07c233d18030b5f3f0c61b85083e2a8f2b5e55/1"
      ```

      * Response

      ```json
      {
     "accountProof":[
        "0xf90211a0d82a1a6e4b71bef93f5815bdf67bdeaa34df3daa774bbe36102383832139b105a0ef290d48d47b459f17a29fd9819d1cbf6de5ef93f0b16d41a226304d5b1038e0a00a7fb2ce24c8c32391c872cc4982d30778c3f2ed6502dd9eb845dbc42cffdabba026619f27ead8de859af55f45b9da7dae18097b9e6b9ac0e7b8c11d4365f94a92a068decdc2e8e5ebfd28daa4c3846272ddb4f89dc5232db0f40eb309ef334e459ea014e5ca1fe814136250533e63efa6d3629f9a62b5ee1441a10b264fcf7a9d909ba0dee7bd2e76cf85a2dc570be9fcb016d2cbd739bb831316958531e769cc81ad3fa020c0923882f63805265ccf325a18b74dc13a0847001bfc220fb1271c07556f50a0d858656224d15f74d9f534e8b596ff8d42d1b157d2ebaf1f9bc3c1cdea23569da0ee0522cdd09d809f59280cc3ade7034172434155639f2c383328e9fc29c51b12a0fa774385c61c0eaa01636bb20f341cb8b98248dfc2a7d5c37a7e0b381ee73e13a01881328179b5763c97acca9c93a48efdb0a37788bc4065f94a300c7a03a97b90a0d1873665bba49ce440022dd6b7f5e64622b95b0324284d1d1eeb17c3bcc73936a09f66e6b7545b3afce5d71a42d581f740a9559389ffe218ad7a133e6c82c71b78a0168cd79444e86de07c23231e3610b72934cc3ce64cc307d1c5313621c70bafe3a0e6e1028c5ad4253809fb37962ee3398d5dd54d6818f60f6473c1a54a1f78bec680",
        "0xf90211a0aa96d7f21382769b2d696d25a26ae2d32a9bb886e33d1277d99745107f1b4453a0509cb3989898c5e230e23ce57e3d8c2824ff9147948aabc87f5fa2ad24ec911da0079c1ef016e517e426605354346bc6d158abb3202e7ce3cf8a420775a7d19ccaa07acd5dfbdf2151f5ea829ee3a4e13a7ba009df85f85d0071923f6f58aaec197fa03bdf5d044ab85ffb8b844717aaa92dbdbea36a3977aa821ad9c69623effa01d7a0e8ca6a93b790c277cee3c3748669196d6d02ba7ffdb01779d94694a9e7fa317da0ace444f5cdec4e8c149025c52009ad5185d488e66c51c6d33f34e8785ebb8c01a07deb76b38b850fdcc81a784ffeff3f67ee509e94c257666cc01412db0386fdfca0b51c7f5dee17fc0dc892cb02cbf14d99613067d69754ad95ef5cd25e7cdec1e0a08bcfbf4a22c23897744033bc11901803c05709ebe9a075dd29ad21bca38be0f5a0e495250d43952775190d3e9190a4c9f99729a0754fd7d19fe395740ea5ad1846a0f54660d3a1af3fef02ed50c6b1f76fa2527fab689d72cb53e584fcd810a3d757a09df31fdcf798b15dee3d26495f5d5219160f1952994f29cbf7d1ca2d9ab5d799a0cfed40cabaec692529da27ccfc09bec74fa8028ea128832cbb93b2d850dff777a02f28f7d9d1d8ef16d2ffe7962f7b329763e1c82dccd810ff7d5cd897ea79c8a0a0ac192760935c5dc2345419eb34322b2280709e883b6d085ceb3b07ef7683b11e80",
        "0xf90211a091204c60d60c1b7e204d7af46451a89d3042ed9cadde7800ed3e2cd65353099ea0bb985c2a60ebe03cfedd0bea2d20178952ad99ce25a382cf649d9d8a41613fb7a01af16d89d96f0449932166fe2ef470252ee22154b80978ea23c1ef7761f1352da0966abe128e0ea22edf1f81027c4d7481e68d225fe125edb07264d23efad53d53a0c2ac8b17ce9c565a2860bb0e44cd53b6739d484c1c6a41214db25aa288b58a46a0a069b99ab2c03280cf6774905aac0c50c70cf1a48d2603da8667716de2088dd7a03dccef174f44e775cd9e4faad1de8abafbe21e49b6633c0eec6f1d647c2247f9a03ddfc273df3e7d4a8b55ab12b76a818f3bee444f8ada10509e05dfcb9d67b397a083dabdda6e483a7bf9b67b1f302943174898d38fc390f7988edb856d30dfffe0a028af290f1879de05a0da530f1b938e3b1ac0130918db47848c837beef5598cfea0deb62dbf9acd4da197e47214dc09684542c0da33f4acf29f0d45f6cb35dfcf3ba01bc06cc9130098fd8ae7909f64c158478ae02ba700f9599235b758c2c183d5a9a0d4d6d64d16c45f44f8162f40c3fad90b5f2ea0bebf3e17dd57d59ebc69c14edea0ed83eb3f5e6838ee6a0f8f90e360d841aa7284b43d10fe217db925f5526b3e58a03fbe4faf61e6164b320021980816d5706a39548c1e4eb005668020a1354dc92ca01b80a56fbb4b23d8a2b501a70f7ff5c5ee78aa3b0cae4937f43d0d875f3c6de180",
        "0xf90211a0848146b2c2f2fce024033a40d0b2f3e521ffdb7b62af886858d5de9c5eac4f22a0e592e29735464b2889865598e81f60762f63595f69c7a6f4be4e4016d4f64c12a07edc45f867ecb17a03dc5f8ce66769874284e64c77cb221c9af07e92462a5c67a0fc02752d0dff6b068605d977f2552a9a3bb1dbc91fd2a9ac8688c8899f48c8c0a026485194771d80adc1201913bd35f8913df62a8737eabb011c75f17b85deeb82a07a0866b6d01fe4526d9c65672c351c92f48f8ef4798395400f9b7b84d88cc624a0dba0f4bfa5728f7ed18f7528d768ea331a5d36b7c82ae437063531f5c1cb71dba0c02aee3cb0f304214468420e978ed8d955915f24f99d15c7a3b0ce4841779766a09d42d7078281ccd075f51cc77dc673c49653edf0c5dc6a6a4b899727d990af01a0cf0dba571efa765ac43e3f737e967fca47149edf8a162208b8f6568ef3ee9c5ea02cceec332d0d2d05849e98cc85cc3b1bf10effafe4623824c58641606f40e55ea0202e89449e81d8c9db7f432787f0b4a95e3336511b0bcef96d25e35b9327b4c6a0918bbf22e656e37f43d2764faaebcf5a11ce61b1e8a810433d4a0b2c5ea2bdbaa0510435ca2f44b50c2b42d2a0ee4bfe6f3a277ced3dff898b35e7646681b2ac9ba0c9b0d0ed10e6b2768ea363d23a7ba9fd410cff56b7f1aafd7bc7f71ad0c316dea07b4bd2dbfa5d9a133c3d5f366f95f93afe380b3c76a7ff672fba8e992b9737bb80",
        "0xf90211a093f15515ca2da221e39815c217c927b09b7bf6d6857d295b3d8015671dd139dca09f10a1e15f1ee0eaa0b5fa585dab17e7ffabea140a782908ce695f3363fb546fa0f4a360baae79155c719611cb56c0660e65be7ad6ccd526e31cfdf1358e5fab2da0b4ee2eb1a4dd70ac949671fca564d3593182e919d1333458fa5fb959afa6dd1da05b0b56d1c1f08097716f21eb8924391b4ee9417970f7ff4a6a2acccba683fbc2a0851d2ab5d0001d600946be31a2a9447bd2abd9a1b1ab87e0528e6275b0a01b66a02e52c23cf7278e1baf5744541a4aac94b7665bc2aebf1409b6e6f8cc5bc6c70fa0fe5e0a807afe4aa32af01160d81d195087bc55ddefa823094a0bffb81b716e40a03e37b59ee99194ab2ee1a0645cf8b9d8181c2e8b59f2579ed2f28566f9a0fc2ba04d4e36088935aed10afba45cf11a4164527b850a15399c4385cf908974c1433aa057852fc04f5b128e7cb33bc26a4dbc85504fdefe06d1376bce737752109e504fa095dab9ca0ac2a64da4d7f183eae49a61279513e61a70e6a03d0e48f400e6ffc9a0a5d56cd6c4e182c73ba1be43e92faf75e15b3237367fa6bcad16d0d65a8d344aa0696927bd0008122307c7d7c3d1330421ffd74447b15c05ab02232337b830c5aea0d8222b8d6d92b7ef208d436332d3d95d1f1032cc1db964f33550ab6f45d9056ba06fdcfbcf19215c60f7cbe5a8a24b002d47b8c4df8e4647cc508f5d5be115438480",
        "0xf901f1a0d1f6c19278ea0a4ad8b483a97dd8e18bacfb8fff5e50f86f5f1cb64889e97d3aa016a23ac6d4741388d3b773d7ed99944765952978e05ee15c1aaae78b8f09df5fa0c64ce3b92621fc9c8c3f4a0eb4def93897b85ba0e6ec798640cfddaf3aa5d741a05783102f562cb9e28d1619b282283739824d0d0192a565472cfad1022dbec8cea0df0225d43fcc8aa62fbdfcfe30dda1cc71f3ff5e6dd1ea43aecd516783716420a0530c282b562e69b6d2e173cbeaff55d13cbc5a5e47f6484e4ce02e29c3842650a03edc7b920b93f5c5b83a49fa871c078b0c3bdca2dbeca03d5ac81f7194bc3b05a04cf0321ada23135412107cc0d1efc54dfbf9dfa4d9e0b8875264c441ad1f469580a079553af90b9c9525213a7645d789e5b7f07b2facccf6230c2be4f021bc29428ca020d369ed6d163fb72ecdd3327997ff34571b3507a42043ad194023b8926a1078a0e9ef8a45efffe4d48c2efac05189d959acc094b9e42c268e52348905b18199b5a09c497667d40309527642c1a0305e61893e5ea045ab280611ede9f633a98fc1a0a03c7064c1a1938d52d4411adb48a2662339537b1622e18f6645e6f555e21491d6a004bef343aeb46fc5f2b87ce46a42d753828211142a34c7737f9253a817f6ff31a0cde2c6f3d07d865d08ea2f3860944612121bd6911383a26b6dbdbd859380f11f80",
        "0xf891a0701700b4bfcbe400300b1f9ac96f8eb11fa54ff98556eaea24939f704570163f80a016ca462a06b115edf2fc878a1b4e55d3489441a7ddb7d15ed5fcfc35cefced9080808080808080a0e44ba3f62abf6a48603e8b844d1159c3fb59b99aed16531178a1d959db59ff4380808080a0203ff2df5a1c23f3a39cc4ff65a2f2bec349e86b99a23a9eb3798bcf1854979580",
        "0xf8669d3926213ae00cb4839ad4802822dc00efee94c8495aa23633b3f5dd6299b846f8440280a0c2cf7c0200ca6b40f60bacc94fdfc3a05ac93774caa9fb8d73f9a8fe6b7e4611a0faf8cfbc249f506e086ff4e8b24ef6dffff173ed61bc0be21e7fdc94387c29ec"
     ],
     "storageProof":[
        "0xf90191a0bea0a7fbf9c78bfb8664188eeed2b9436918ee5a33a1d7261f48cf18751fd16da009e1e394deef5b45cfafd89ba5a26c5c526c7291953463df1931a7818e5621ea808080a014e7cb190268fb890bc9ba105fa0a7124fffdaeac4c665f7cef50a35bc58dd25a0e789e81a13043a275e311b497289f011060a9e170fd51772bb0bee4beae5de45a0ffd803e4dd13cf44a40cef45bbcb6901c416e3631f092033997b48c2b3be5971a054d6b2d67cd7073869ead7a704fce7d8d1c898770e527544a5d21391d604c677a073dea50c486220cc8ac56eb1c1ebffe1aefa87b61fa800eb25ca6f5e9f71f25ba0bacb2c9831ee80021162f753ab440c1d98365188291be2b9772a5e6b51551d3680a0c8582290badc2c5d689dfb985eb158bce48110562cad785e5b603b39b148f364a034cb746025a322fd37c92085994d82b7d37ae6003ba5645eb62846863adeba2ba079866ac4ff54c3062d8fbd4fa347961e9a905b4114a2ed9785e22a5c03f4ffb8a0e5147e363e3eed76b3fdc69df1563c4f86b396ddd8cf666aae067b1dcf3a39dc80",
        "0xf843a036b32740ad8041bcc3b909c72d7e1afe60094ec55e3cde329b4b3a28501d826ca1a032df0037f470676cb92955248a2fa07795d2003440d13e44692134b8dfc94773"
     ]

      }
     ```

### Map slot to Ethereum block number

* To map Ethereum slot to a block number:

    * Request

      `GET /beacon/slot/:slot_number`

      ```bash
      # curl <endpoint URL>/beacon/slot/<slotNumber>
      curl http://localhost:8080/beacon/slot/4448512
      ```

    * Response

      ```json
      {"blockHash":"0x5282299b298fe1d7238f1a48aa0f5e7cc19ccbcdeeba020b610db78abeb0d52b","blockNumber":5380093}
      ```
